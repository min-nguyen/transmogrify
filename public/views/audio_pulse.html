<!DOCTYPE html>
<html lang="en">
<head>
	<title>Audio Analysis Demo</title>
	<meta charset="utf-8">
    <link href="../stylesheets/tools/audio_pulse.css" rel="stylesheet" type="text/css">
  
    <script type="text/javascript" charset="utf-8" async="" src="https://platform.twitter.com/js/button.b74390cfaab5c0218a0e372047007e13.js"></script>
</head>
<body>
	<div class = "pulse_contentWrapper">
        <div class="pulse_experiment" id="r3">
                <div class="pulse_initiator"></div>
                <div id="circles" class="pulse_area"><div class="pulse_circle" style="transform: scale(0.671875);"></div>
                <div class="pulse_circle" style="transform: scale(0.683594);"></div><div class="pulse_circle" style="transform: scale(0.65625);"></div>
                <div class="pulse_circle" style="transform: scale(0.605469);"></div><div class="pulse_circle" style="transform: scale(0.582031);"></div>
                <div class="pulse_circle" style="transform: scale(0.585938);"></div><div class="pulse_circle" style="transform: scale(0.578125);"></div>
                <div class="pulse_circle" style="transform: scale(0.53125);"></div><div class="pulse_circle" style="transform: scale(0.457031);"></div>
                <div class="pulse_circle" style="transform: scale(0.523438);"></div><div class="pulse_circle" style="transform: scale(0.601562);"></div>
                <div class="pulse_circle" style="transform: scale(0.601562);"></div><div class="pulse_circle" style="transform: scale(0.621094);">

                </div><div class="pulse_circle" style="transform: scale(0.628906);"></div><div class="pulse_circle" style="transform: scale(0.605469);">

                </div><div class="pulse_circle" style="transform: scale(0.542969);"></div><div class="pulse_circle" style="transform: scale(0.519531);">

                </div><div class="pulse_circle" style="transform: scale(0.476562);"></div>
                <div class="pulse_circle" style="transform: scale(0.429688);">
                </div><div class="pulse_circle" style="transform: scale(0.472656);"></div>
                <div class="pulse_circle" style="transform: scale(0.472656);"></div>
                <div class="pulse_circle" style="transform: scale(0.382812);"></div>
                <div class="pulse_circle" style="transform: scale(0.242188);"></div>
                <div class="pulse_circle" style="transform: scale(0.214844);"></div>
                <div class="pulse_circle" style="transform: scale(0.078125);"></div>
                <div class="pulse_circle" style="transform: scale(0);"></div><div class="pulse_circle" style="transform: scale(0);"></div>
                <div class="pulse_circle" style="transform: scale(0);"></div><div class="pulse_circle" style="transform: scale(0);"></div>
                <div class="pulse_circle" style="transform: scale(0);"></div><div class="pulse_circle" style="transform: scale(0);"></div>
                <div class="pulse_circle" style="transform: scale(0);"></div></div>
        </div>
    
	
        <audio id="r0audio" src="../res/AJJ.mp3"></audio>
    </div>

	<script src="../javascripts/jstools/minivents.min.js"></script>
	<script src="../javascripts/jstools/jquery-3.2.1.min.js"></script>
	<script src="../javascripts/jstools/jquery-ui.min.js"></script>
	<script src="../javascripts/jstoolsstats.min.js"></script>
	<script src="../javascripts/jstools/dat.gui.min.js"></script>
	<script src="../javascripts/jstools/atutil.js"></script>
</body>
<script type="text/javascript">
    document.onload  = function(){
    window.AudioContext = window.AudioContext || window.webkitAudioContext || window.mozAudioContext; var renderers = {
        'r3': (function () {
            var circles = []; var initialized = false; var height = 0; var width = 0; var init = function (config) {
                var count = config.count; width = config.width; height = config.height; var circleMaxWidth = (width * 0.66) >> 0; circlesEl = document.getElementById('circles'); for (var i = 0; i < count; i++) { var node = document.createElement('div'); node.style.width = node.style.height = (i / count * circleMaxWidth) + 'px'; node.classList.add('pulse_circle'); circles.push(node); circlesEl.appendChild(node); }
                initialized = true;
            }; var max = 256; var renderFrame = function (frequencyData) { for (var i = 0; i < circles.length; i++) { var circle = circles[i]; circle.style.cssText = '-webkit-transform:scale(' + ((frequencyData[i] / max)) + ')'; } }; return { init: init, isInitialized: function () { return initialized; }, renderFrame: renderFrame }
        })()
    }; window.onload = function () {
        function Visualization(config) {
            var audio, audioStream, analyser, source, audioCtx, canvasCtx, frequencyData, running = false, renderer = config.renderer, width = config.width || 360, height = config.height || 360; var init = function () { audio = document.getElementById('r0audio'); audioCtx = new AudioContext(); analyser = audioCtx.createAnalyser(); source = audioCtx.createMediaElementSource(audio); source.connect(analyser); analyser.connect(audioCtx.destination); analyser.fftSize = 64; frequencyData = new Uint8Array(analyser.frequencyBinCount); renderer.init({ count: analyser.frequencyBinCount, width: width, height: height }); }; this.start = function () { audio.play(); running = true; renderFrame(); }; this.stop = function () { running = false; audio.pause(); }; this.setRenderer = function (r) {
                if (!r.isInitialized()) { r.init({ count: analyser.frequencyBinCount, width: width, height: height }); }
                renderer = r;
            }; this.isPlaying = function () { return running; }
            var renderFrame = function () { analyser.getByteFrequencyData(frequencyData); renderer.renderFrame(frequencyData); if (running) { requestAnimationFrame(renderFrame); } }; init();
        }; var vis = document.querySelectorAll('.pulse_initiator'); var v = null; var lastEl; var lastElparentId; for (var i = 0; i < vis.length; i++) {
            vis[i].onclick = (function () {
                return function () {
                    var el = this; var id = el.parentNode.id; if (!v) { v = new Visualization({ renderer: renderers[id] }); }
                    v.setRenderer(renderers[id]); 
                    if (v.isPlaying()) 
                        { if (lastElparentId === id) { v.stop(); } else { /*lastEl.style.backgroundColor = 'rgba(0,0,0,0.5)'; el.style.backgroundColor = 'rgba(0,0,0,0)';*/ } } 
                    else { v.start(); }
                    lastElparentId = id; lastEl = el;
                };
            })();
        }
    };
}
</script>

</html>